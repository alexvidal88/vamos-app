
<div class="weather-search">
  <div class="search-item" id="map"
     style="width: 100%; height: 250px;"
     data-markers="<%= @markers.to_json %>"
     data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>">
  </div>

  <% if @searches.count != 0 %>
    <% @output.each do |out|  %>
    <div class="search-card search-item">
      <small class="text-right"> <%= link_to "delete", weather_search_path(out[:id]), method: :delete, remote: true, data: {confirm: "Are you sure you want to delete this search?"}  %></small>
      <div class="first-section text-center">
        <div>
          <small>Location: <%= out[:address] %> </small>
        </div>
        <div>
          <small> Searched: <%= out[:date] %> at <%= out[:exact_time] %> hrs</small>
        </div>
      </div>

      <div class="second-section d-flex justify-content-around">
        <div>
          <% out[:keys].each do |key| %>
            <li> <%=  retriever(out[:api]["data"]["weather"], key, out[:weather_type], out[:time]) %></li>
          <% end %>
        </div>
        <div>
          <div class="d-flex justify-content-center">
            <small> <%= image_tag "#{ url_retriever(out[:api]["data"]["weather"], out[:weather_type], out[:time])}", class: "avatar" %></small>
          </div>
          <div>
            <small> <%= weather_comment(out[:api]["data"]["weather"], out[:weather_type], out[:time]) %></small>
          </div>
        </div>
      </div>

      <div class="third-section">
        <a class="toggle">See comments</a>
          <div>
            <% out[:search].reviews.each do |review| %>
                  <div class="d-flex justify-content-start">
                    <div class="d-flex chat-box">
                      <% if review.user.photo.attached?%>
                        <%= cl_image_tag(review.user.photo.key, class: "avatar-chat dropdown-toggle", id: "navbarDropdown", data: { toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false)%>
                      <% else %>
                       <%= image_tag "https://res.cloudinary.com/batch-588/image/upload/v1627822930/squartl_avatar_t1rfxo.jpg", class: "avatar-chat dropdown-toggle", id: "navbarDropdown", data: { toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false %>
                      <% end %>
                      <div class="chat-box">
                        <% if review.user == current_user %>
                          <small>You</small>
                        <% else %>
                          <small><%= review.user.first_name.capitalize %></small>
                        <% end %>
                        <p id="review-<%= review.id %>" class="chat-card">  <%=  review.content.capitalize %> </p>
                        <small class="date"><%= review.created_at %></small>
                      </div>
                    </div>
                  </div>
                <% end %>
            <%= simple_form_for([out[:search], @review ], remote: true) do |f| %>
            <%= f.input :content, as: :text, label: false %>
            <%= f.button :submit %>
            <% end %>
            <% if session[:review_error]%>
              <p><%= session[:review_error]%> </p>
            <% end %>
          </div>
      </div>
    </div>
    <% end %>
</div>

  <% else %>
      <small> There is no searches listed yet</small>
  <% end %>









